<div align="center">

# GeminiCli2API ğŸš€

**ä¸€ä¸ªå°† Google Gemini CLI å°è£…ä¸ºæœ¬åœ° API çš„å¼ºå¤§ä»£ç†ï¼Œå¹¶æä¾› OpenAI å…¼å®¹æ¥å£ã€‚**

</div>

<div align="center">

[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![Node.js](https://img.shields.io/badge/Node.js-â‰¥18.0.0-green.svg)](https://nodejs.org/)

[**ä¸­æ–‡**](./README.md) | [**English**](./README-EN.md)

</div>

> `GeminiCli2API` åŒ…å«ä¸¤ä¸ªç‹¬ç«‹çš„ Node.js HTTP æœåŠ¡å™¨ï¼Œå®ƒä»¬ä½œä¸º Google Cloud Code Assist API çš„æœ¬åœ°ä»£ç†ã€‚å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨æ›´æ˜¯æä¾›äº†ä¸ OpenAI API å®Œå…¨å…¼å®¹çš„æ¥å£ã€‚è¿™è®©æ‚¨å¯ä»¥æ‘†è„±ç»ˆç«¯ç•Œé¢çš„æŸç¼šï¼Œå°† Gemini çš„å¼ºå¤§èƒ½åŠ›ä»¥ API çš„å½¢å¼è½»æ¾æ¥å…¥åˆ°ä»»ä½•æ‚¨å–œçˆ±çš„å®¢æˆ·ç«¯æˆ–åº”ç”¨ä¸­ã€‚

---

## ğŸ“ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®ç”±ä¸‰ä¸ªæ ¸å¿ƒæ–‡ä»¶æ„æˆï¼Œå„å¸å…¶èŒï¼š

*   `gemini-api-server.js`: ğŸ’ **åŸç”Ÿ Gemini ä»£ç†æœåŠ¡**
    *   ä¸€ä¸ªç‹¬ç«‹çš„ Node.js HTTP æœåŠ¡å™¨ï¼Œä½œä¸º Google Cloud Code Assist API çš„æœ¬åœ°ä»£ç†ã€‚
    *   å®ƒæä¾›äº†æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å’Œé”™è¯¯ä¿®å¤ï¼Œè®¾è®¡ç¨³å¥ã€çµæ´»ï¼Œå¹¶é…å¤‡äº†å…¨é¢å¯æ§çš„æ—¥å¿—ç³»ç»Ÿï¼Œæ–¹ä¾¿ç›‘æ§å’Œè°ƒè¯•ã€‚

*   `openai-api-server.js`: ğŸ”„ **OpenAI å…¼å®¹ä»£ç†æœåŠ¡**
    *   åŸºäº `gemini-api-server.js` æ„å»ºï¼ŒåŒæ ·ä½œä¸º Google API çš„ä»£ç†ã€‚
    *   å…³é”®åœ¨äºï¼Œå®ƒå¯¹å¤–æš´éœ²äº†ä¸ OpenAI API å…¼å®¹çš„æ¥å£ã€‚è¿™æ„å‘³ç€ä»»ä½•æ”¯æŒ OpenAI API çš„å®¢æˆ·ç«¯éƒ½æ— éœ€ä¿®æ”¹ä»£ç ï¼Œå³å¯æ— ç¼åˆ‡æ¢ä½¿ç”¨ã€‚

*   `gemini-core.js`: âš™ï¸ **æ ¸å¿ƒå…±äº«é€»è¾‘**
    *   è¿™æ˜¯ä¸¤ä¸ªæœåŠ¡å™¨å…±äº«çš„å¿ƒè„ï¼ŒåŒ…å«äº†è®¤è¯ã€API è°ƒç”¨ã€è¯·æ±‚/å“åº”å¤„ç†ä»¥åŠæ—¥å¿—è®°å½•ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

---

## ğŸ’¡ æ ¸å¿ƒä¼˜åŠ¿

*   âœ… **çªç ´å®˜æ–¹é™åˆ¶**ï¼šè§£å†³äº† Gemini å®˜æ–¹å…è´¹ API é¢åº¦ç´§å¼ çš„é—®é¢˜ã€‚é€šè¿‡æœ¬é¡¹ç›®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Gemini CLI çš„è´¦å·æˆæƒï¼Œäº«å—æ›´é«˜çš„æ¯æ—¥è¯·æ±‚é™é¢ã€‚
*   âœ… **æ— ç¼å…¼å®¹ OpenAI**ï¼šæä¾›äº†ä¸ OpenAI API å®Œå…¨å…¼å®¹çš„æ¥å£ï¼Œè®©æ‚¨ç°æœ‰çš„å·¥å…·é“¾å’Œå®¢æˆ·ç«¯ï¼ˆå¦‚ LobeChat, NextChat ç­‰ï¼‰å¯ä»¥é›¶æˆæœ¬æ¥å…¥ Geminiã€‚
*   âœ… **å¢å¼ºçš„å¯æ§æ€§**ï¼šé€šè¿‡å¼ºå¤§çš„æ—¥å¿—åŠŸèƒ½ï¼Œå¯ä»¥æ•è·å¹¶è®°å½•æ‰€æœ‰è¯·æ±‚çš„æç¤ºè¯ï¼ˆPromptsï¼‰ï¼Œä¾¿äºå®¡è®¡ã€è°ƒè¯•å’Œæ„å»ºç§æœ‰æ•°æ®é›†ã€‚
*   âœ… **æ˜“äºæ‰©å±•**ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œæ–¹ä¾¿æ‚¨è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå®ç°å¦‚ç»Ÿä¸€å‰ç½®æç¤ºè¯ã€å“åº”ç¼“å­˜ã€å†…å®¹è¿‡æ»¤ç­‰è‡ªå®šä¹‰åŠŸèƒ½ã€‚

### âš ï¸ ç›®å‰çš„å±€é™

*   æš‚æœªå®ç°åŸç‰ˆ Gemini CLI çš„éƒ¨åˆ†å†…ç½®å‘½ä»¤åŠŸèƒ½ã€‚
*   å¤šæ¨¡æ€èƒ½åŠ›ï¼ˆå¦‚å›¾ç‰‡è¾“å…¥ï¼‰å°šåœ¨å¼€å‘è®¡åˆ’ä¸­ (TODO)ã€‚

---

## ğŸ› ï¸ ä¸»è¦åŠŸèƒ½

### ğŸ’ Gemini API Server (`gemini-api-server.js`)

*   ğŸ” **è‡ªåŠ¨è®¤è¯ä¸ä»¤ç‰Œç»­æœŸ**: é¦–æ¬¡è¿è¡Œå°†å¼•å¯¼æ‚¨é€šè¿‡æµè§ˆå™¨å®Œæˆ Google è´¦å·æˆæƒã€‚è·å–çš„ OAuth ä»¤ç‰Œä¼šå®‰å…¨å­˜å‚¨åœ¨æœ¬åœ°ï¼Œå¹¶åœ¨è¿‡æœŸå‰è‡ªåŠ¨åˆ·æ–°ï¼Œç¡®ä¿æœåŠ¡ä¸é—´æ–­ã€‚
*   ğŸ”— **ç®€åŒ–çš„æ‰‹åŠ¨æˆæƒæµç¨‹**:
    1.  **å¤åˆ¶æˆæƒé“¾æ¥**ï¼šç»ˆç«¯ä¼šè¾“å‡ºä¸€ä¸ª Google æˆæƒ URLã€‚
    2.  **æµè§ˆå™¨æˆæƒ**ï¼šåœ¨ä»»ä½•å›¾å½¢ç•Œé¢è®¾å¤‡çš„æµè§ˆå™¨ä¸­æ‰“å¼€è¯¥ URLï¼Œç™»å½•å¹¶æˆäºˆæƒé™ã€‚
    3.  **ç²˜è´´é‡å®šå‘URL**ï¼šæˆæƒåï¼Œæµè§ˆå™¨ä¼šå°è¯•é‡å®šå‘åˆ°ä¸€ä¸ª `localhost` åœ°å€ï¼Œå›ç»ˆç«¯å³å¯å®Œæˆè®¤è¯ã€‚
    > å‡­è¯æ–‡ä»¶å°†å­˜å‚¨äºï¼š
    > *   **Windows**: `C:\Users\USERNAME\.gemini\oauth_creds.json`
    > *   **macOS/Linux**: `~/.gemini/oauth_creds.json`
*   ğŸ”‘ **çµæ´»çš„ API å¯†é’¥æ ¡éªŒ**: æ”¯æŒé€šè¿‡ URL æŸ¥è¯¢å‚æ•° (`?key=...`) æˆ– `x-goog-api-key` è¯·æ±‚å¤´æä¾› API å¯†é’¥ã€‚
*   ğŸ”§ **è§’è‰²è§„èŒƒåŒ–ä¿®å¤**: è‡ªåŠ¨ä¸ºè¯·æ±‚ä½“æ·»åŠ å¿…è¦çš„ 'user'/'model' è§’è‰²ï¼Œå¹¶æ­£ç¡®å¤„ç† `systemInstruction`ã€‚
*   ğŸ¤– **å›ºå®šçš„æ¨¡å‹åˆ—è¡¨**: é»˜è®¤æä¾›å¹¶ä½¿ç”¨ `gemini-1.5-pro-latest` å’Œ `gemini-1.5-flash-latest` æ¨¡å‹ã€‚
*   ğŸŒ **å®Œæ•´çš„ Gemini API ç«¯ç‚¹æ”¯æŒ**: å®Œæ•´å®ç°äº† `listModels`, `generateContent`, å’Œ `streamGenerateContent`ã€‚
*   ğŸ“œ **å…¨é¢å¯æ§çš„æ—¥å¿—ç³»ç»Ÿ**: å¯å°†å¸¦æ—¶é—´æˆ³çš„æç¤ºè¯æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°æˆ–æ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤ºä»¤ç‰Œå‰©ä½™æœ‰æ•ˆæœŸã€‚

### ğŸ”„ OpenAI å…¼å®¹ API Server (`openai-api-server.js`)

*   ğŸŒ **OpenAI API å…¼å®¹æ€§**: å®Œç¾å®ç°äº† `/v1/models` å’Œ `/v1/chat/completions` æ ¸å¿ƒç«¯ç‚¹ã€‚
*   ğŸ”„ **è‡ªåŠ¨æ ¼å¼è½¬æ¢**: åœ¨å†…éƒ¨è‡ªåŠ¨å°† OpenAI æ ¼å¼çš„è¯·æ±‚/å“åº”ä¸ Gemini æ ¼å¼è¿›è¡Œæ— ç¼è½¬æ¢ã€‚
*   ğŸ’¨ **æµå¼ä¼ è¾“æ”¯æŒ**: å®Œå…¨æ”¯æŒ OpenAI çš„æµå¼å“åº” (`"stream": true`)ï¼Œæä¾›æ‰“å­—æœºèˆ¬çš„å®æ—¶ä½“éªŒã€‚
*   ğŸ›¡ï¸ **å¤šæ ·çš„è®¤è¯æ–¹å¼**: æ”¯æŒ `Authorization: Bearer <key>`, URL æŸ¥è¯¢å‚æ•° (`?key=...`) å’Œ `x-goog-api-key` è¯·æ±‚å¤´è¿›è¡Œ API å¯†é’¥æ ¡éªŒã€‚
*   âš™ï¸ **é«˜åº¦å¯é…ç½®**: å¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°çµæ´»é…ç½®ç›‘å¬åœ°å€ã€ç«¯å£ã€API å¯†é’¥å’Œæ—¥å¿—æ¨¡å¼ã€‚
*   â™»ï¸ **é‡ç”¨æ ¸å¿ƒé€»è¾‘**: åº•å±‚ä¸ Gemini API Server å…±äº« `gemini-core.js`ï¼Œä¿è¯äº†ç¨³å®šæ€§ä¸ä¸€è‡´æ€§ã€‚

---

## ğŸ“¦ å®‰è£…æŒ‡å—

1.  **ç¯å¢ƒå‡†å¤‡**:
    *   è¯·ç¡®ä¿æ‚¨å·²å®‰è£… [Node.js](https://nodejs.org/) (å»ºè®®ç‰ˆæœ¬ >= 18.0.0)ã€‚
    *   æœ¬é¡¹ç›®å·²åŒ…å« `package.json` å¹¶è®¾ç½® `{"type": "module"}`ï¼Œæ‚¨æ— éœ€æ‰‹åŠ¨åˆ›å»ºã€‚

2.  **å®‰è£…ä¾èµ–**:
    å…‹éš†æœ¬ä»“åº“åï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š
    ```bash
    npm install
    ```
    è¿™å°†è‡ªåŠ¨å®‰è£… `google-auth-library` å’Œ `uuid` ç­‰å¿…è¦ä¾èµ–ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. Gemini API Server (`gemini-api-server.js`)

#### â–¶ï¸ å¯åŠ¨æœåŠ¡
*   **é»˜è®¤å¯åŠ¨** (ç›‘å¬ `localhost:3000`)
    ```bash
    node gemini-api-server.js
    ```
*   **ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£** (ç”¨äº Docker æˆ–å±€åŸŸç½‘è®¿é—®)
    ```bash
    node gemini-api-server.js 0.0.0.0
    ```
*   **æ‰“å°æç¤ºè¯åˆ°æ§åˆ¶å°**
    ```bash
    node gemini-api-server.js --log-prompts console
    ```
*   **ç»„åˆå‚æ•°** (æŒ‡å®š IPã€ç«¯å£ã€API Key å¹¶è®°å½•æ—¥å¿—åˆ°æ–‡ä»¶)
    ```bash
    node gemini-api-server.js 0.0.0.0 --port 3001 --api-key your_secret_key --log-prompts file
    ```
*   **é€šè¿‡ base64 ç¼–ç çš„å‡­è¯å¯åŠ¨** (ä¾‹å¦‚ï¼Œç”¨äº Docker æˆ– CI/CD ç¯å¢ƒ)
    ```bash
    node gemini-api-server.js --oauth-creds-base64 "YOUR_BASE64_ENCODED_OAUTH_CREDS_JSON"
    ```
*   **é€šè¿‡æŒ‡å®šå‡­è¯æ–‡ä»¶è·¯å¾„å¯åŠ¨** (ä¾‹å¦‚ï¼Œç”¨äºè‡ªå®šä¹‰å‡­è¯ä½ç½®)
    ```bash
    node gemini-api-server.js --oauth-creds-file "/path/to/your/oauth_creds.json"
    ```

#### ğŸ’» è°ƒç”¨ API (é»˜è®¤ API Key: `123456`)
*   **åˆ—å‡ºæ¨¡å‹**
    ```bash
    curl "http://localhost:3000/v1beta/models?key=123456"
    ```
*   **ç”Ÿæˆå†…å®¹ (å¸¦ç³»ç»Ÿæç¤º)**
    ```bash
    curl "http://localhost:3000/v1beta/models/gemini-2.5-pro:generateContent" \
      -H "Content-Type: application/json" \
      -H "x-goog-api-key: 123456" \
      -d '{
        "system_instruction": { "parts": [{ "text": "ä½ æ˜¯ä¸€åªåå« Neko çš„çŒ«ã€‚" }] },
        "contents": [{ "parts": [{ "text": "ä½ å¥½ï¼Œä½ å«ä»€ä¹ˆåå­—ï¼Ÿ" }] }]
      }'
    ```
*   **æµå¼ç”Ÿæˆå†…å®¹**
    ```bash
    curl "http://localhost:3000/v1beta/models/gemini-2.5-flash:streamGenerateContent?key=123456" \
      -H "Content-Type: application/json" \
      -d '{"contents":[{"parts":[{"text":"å†™ä¸€é¦–å…³äºå®‡å®™çš„äº”è¡ŒçŸ­è¯—"}]}]}'
    ```

### 2. OpenAI å…¼å®¹ API Server (`openai-api-server.js`)

#### â–¶ï¸ å¯åŠ¨æœåŠ¡
*å¯åŠ¨å‚æ•°ä¸ `gemini-api-server.js` å®Œå…¨ä¸€è‡´ã€‚*

*   **ç¤ºä¾‹** (ç›‘å¬ `localhost:8000`, API Key ä¸º `sk-your-key`)
    ```bash
    node openai-api-server.js --port 8000 --api-key sk-your-key
    ```

#### ğŸ’» è°ƒç”¨ API (ä»¥ OpenAI å®¢æˆ·ç«¯æ–¹å¼)
*   **åˆ—å‡ºæ¨¡å‹**
    ```bash
    curl http://localhost:8000/v1/models \
      -H "Authorization: Bearer sk-your-key"
    ```
*   **ç”Ÿæˆå†…å®¹ (éæµå¼)**
    ```bash
    curl http://localhost:8000/v1/chat/completions \
      -H "Content-Type: application/json" \
      -H "Authorization: Bearer sk-your-key" \
      -d '{
        "model": "gemini-2.5-pro",
        "messages": [
          {"role": "system", "content": "ä½ æ˜¯ä¸€åªåå« Neko çš„çŒ«ã€‚"},
          {"role": "user", "content": "ä½ å¥½ï¼Œä½ å«ä»€ä¹ˆåå­—ï¼Ÿ"}
        ]
      }'
    ```
*   **æµå¼ç”Ÿæˆå†…å®¹**
    ```bash
    curl http://localhost:8000/v1/chat/completions \
      -H "Content-Type: application/json" \
      -H "Authorization: Bearer sk-your-key" \
      -d '{
        "model": "gemini-2.5-flash",
        "messages": [
          {"role": "user", "content": "å†™ä¸€é¦–å…³äºå®‡å®™çš„äº”è¡ŒçŸ­è¯—"}
        ],
        "stream": true
      }'
    ```

---

## ğŸŒŸ ç‰¹æ®Šç”¨æ³•ä¸è¿›é˜¶æŠ€å·§

*   **ğŸ”Œ å¯¹æ¥ä»»æ„ OpenAI å®¢æˆ·ç«¯**: è¿™æ˜¯æœ¬é¡¹ç›®çš„æ€æ‰‹çº§åŠŸèƒ½ã€‚é€šè¿‡ `openai-api-server.js`ï¼Œå°†ä»»ä½•æ”¯æŒ OpenAI çš„åº”ç”¨ï¼ˆå¦‚ LobeChat, NextChat, VS Code æ’ä»¶ç­‰ï¼‰çš„ API åœ°å€æŒ‡å‘æœ¬æœåŠ¡ï¼Œå³å¯æ— ç¼ä½¿ç”¨ Geminiã€‚

*   **ğŸ” ä¸­å¿ƒåŒ–è¯·æ±‚ç›‘æ§ä¸å®¡è®¡**: ä½¿ç”¨ `--log-prompts` å‚æ•°æ•è·æ‰€æœ‰å®¢æˆ·ç«¯å‘é€çš„ç³»ç»Ÿæç¤ºè¯å’Œç”¨æˆ·è¯·æ±‚ã€‚è¿™å¯¹äºåˆ†æã€è°ƒè¯•å’Œä¼˜åŒ–æç¤ºè¯ï¼Œç”šè‡³æ„å»ºç§æœ‰æ•°æ®é›†éƒ½è‡³å…³é‡è¦ã€‚

*   **ğŸ› ï¸ ä½œä¸ºäºŒæ¬¡å¼€å‘åŸºçŸ³**:
    *   **ç»Ÿä¸€ç³»ç»Ÿæç¤º**: ä¿®æ”¹ `gemini-core.js`ï¼Œä¸ºæ‰€æœ‰è¯·æ±‚å¼ºåˆ¶æ·»åŠ ä¸€ä¸ªç»Ÿä¸€çš„ã€ä¸å¯è§çš„ç³»ç»Ÿæç¤ºè¯ï¼Œç¡®ä¿ AI å›å¤éµå¾ªç‰¹å®šè§’è‰²æˆ–æ ¼å¼ã€‚
    *   **å“åº”ç¼“å­˜**: å¯¹é«˜é¢‘é‡å¤é—®é¢˜æ·»åŠ ç¼“å­˜é€»è¾‘ï¼Œé™ä½ API è°ƒç”¨ï¼Œæå‡å“åº”é€Ÿåº¦ã€‚
    *   **è‡ªå®šä¹‰å†…å®¹è¿‡æ»¤**: åœ¨è¯·æ±‚å‘é€æˆ–è¿”å›å‰å¢åŠ å…³é”®è¯è¿‡æ»¤æˆ–å†…å®¹å®¡æŸ¥é€»è¾‘ï¼Œæ»¡è¶³åˆè§„è¦æ±‚ã€‚

---

## ğŸ“„ å¼€æºè®¸å¯

æœ¬é¡¹ç›®éµå¾ª [**GNU General Public License v3 (GPLv3)**](https://www.gnu.org/licenses/gpl-3.0) å¼€æºè®¸å¯ã€‚è¯¦æƒ…è¯·æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çš„ `LICENSE` æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®çš„å¼€å‘å—åˆ°äº†å®˜æ–¹ Google Gemini CLI çš„æå¤§å¯å‘ï¼Œå¹¶å‚è€ƒäº†Cline 3.18.0 ç‰ˆæœ¬ `gemini-cli.ts` çš„éƒ¨åˆ†ä»£ç å®ç°ã€‚åœ¨æ­¤å¯¹ Google å®˜æ–¹å›¢é˜Ÿå’Œ Cline å¼€å‘å›¢é˜Ÿçš„å“è¶Šå·¥ä½œè¡¨ç¤ºè¡·å¿ƒçš„æ„Ÿè°¢ï¼
